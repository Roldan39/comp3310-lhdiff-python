# comp3310-lhdiff-python
# LHDiff: Language-Independent Line Tracking Tool
**COMP-3110 Project | Python Implementation v2.2**

## Overview
LHDiff is a tool designed to track lines of source code between two versions of a file. Unlike standard `diff` utilities that only detect insertions and deletions, LHDiff uses **Context** and **Content** similarity to identify lines that have moved, been modified, split, or merged.

This implementation solves the "Line Mapping Problem" by using a hybrid approach involving **Levenshtein Distance** (Content) and **SimHash + Hamming Distance** (Context).

## Features
* **Language Independent:** Works on Java, Python, C++, and text files.
* **Two-Pass Matching Algorithm:** Uses a "Hawk and Mouse" strategy to lock in high-confidence matches before attempting to match ambiguous lines.
* **Bi-Directional Mapping:**
    * **Split Detection:** Detects when one line splits into two (e.g., breaking long arguments).
    * **Merge Detection:** Detects when multiple lines combine into one (e.g., code cleanup).
* **Automated Optimization:** Includes a script to find the best configuration parameters for your dataset.

---

## Installation & Setup

### Prerequisites
* Python 3.x
* No external `pip` packages required (uses standard libraries: `difflib`, `math`, `re`, `argparse`, `hashlib`, `statistics`, `random`).

### Project Structure
```text
comp3310-lhdiff-python/
│
├── lhdiff.py               # The Core Engine (Main Algorithm)
├── evaluate.py             # The Test Harness (Runs against data/)
├── optimize_lhdiff.py      # The Optimization Script (Finds best weights)
│
├── data/                   # Test Dataset (Folders containing _1.java, _2.java, .xml)
├── output/                 # CSV Reports generated by evaluate.py
```

---

## Usage

### 1. Running LHDiff on Two Files
To compare two files and see the line mappings:
```bash
python3 lhdiff.py path/to/old_file.java path/to/new_file.java
```
**Output Format:** `OldLineNumber -> NewLineNumber(s)`

### 2. Running the Evaluation Suite
To run the tool against the provided test dataset and calculate accuracy:
```bash
python3 evaluate.py
```
This will:
1. Run `lhdiff` on every test case in the `data/` folder.
2. Compare the results against the Ground Truth XML files.
3. Print the accuracy for each test case and the overall average.
4. Generate detailed CSV reports in the `output/` directory.

### 3. Optimizing Configuration
To find the best parameters (Weights, Thresholds, Window Size) for your specific dataset:
```bash
python3 optimize_lhdiff.py
```
This script uses a **Randomized Narrowing Search** to efficiently explore the parameter space. It will:
1. Generate random configurations.
2. Evaluate them against the dataset.
3. "Narrow" the search range around the best performers.
4. Repeat for a few generations to find the optimal settings.
5. Output the best configuration found, which you can then copy into `lhdiff.py`.

---

## How It Works

### The Algorithm
1. **Preprocessing:** Lines are normalized (lowercase, whitespace trimmed) and tokenized.
2. **Anchoring:** Exact matches are identified first using `difflib` to serve as "anchors".
3. **SimHash Generation:** A 64-bit SimHash fingerprint is generated for each line's **Context** (the lines surrounding it). This allows for O(1) comparison of context similarity.
4. **Two-Pass Matching:**
    *   **Pass 1 (The Hawk):** Scans for high-confidence matches (High Threshold). It looks for lines with strong Content Similarity (Levenshtein) AND Context Similarity (SimHash).
    *   **Pass 2 (The Mouse):** Scans the remaining unmatched lines with a lower threshold to find subtle changes or moves.
5. **Split/Merge Detection:** If a match is found, the algorithm checks if merging the neighbor lines improves the similarity score, indicating a split or merge.

### Configuration Parameters
*   **CONTENT_WEIGHT:** Importance of the line's text (0.0 - 1.0).
*   **CONTEXT_WEIGHT:** Importance of the surrounding lines (1.0 - CONTENT_WEIGHT).
*   **WINDOW_SIZE:** How many lines above/below to consider for Context.
*   **PASS1_THRESHOLD:** Minimum score required for a match in the first pass.
*   **PASS2_THRESHOLD:** Minimum score required for a match in the second pass.